## 2.1 架构

现实世界中流水线有多个含义，我们渲染里也取这个词来用，表示流水线分成多个阶段，每个阶段代表一个比较独立的大任务。

流水线的每级是并行的，其输入依赖前一级的输出。理想情况下，n级的流水线效率提升应当是没有流水化的n倍。这是我们采用流水线的主要原因。例略。
流水线会因为最慢的一级没有完成任务而停机。我们把这一级叫做流水线的*瓶颈*，后面的级就处于*饥饿*状态。

实时渲染流水线可以粗略分成4个阶段：应用程序，几何处理，光栅化，像素处理。见图2.2。这个图很重要，它是后面的章节的重要的基础。通常每个阶段自己都是一条流水线，也就是说每个阶段包含了若干的子阶段。
我们此处需要区分功能上的阶段和实现上的阶段。功能上每个阶段有特定的事情要做，但是不指明具体怎么实现的。实际的实现其实可能会把多个阶段结合到一个计算单元里面去，也可能把一个费时间的计算过程拆分到不同的硬件单元去。

> 图2.2
> 前略。每个阶段可以自己又是一个流水线，例如几何处理阶段；也可以是一个并行处理的阶段，例如像素处理阶段。图中的应用程序阶段是表示成了一个单独的阶段，但这个阶段也可以被流水化或者并行化。
> 注意光栅化阶段找到了一个图元或者说三角形里内部的的这些像素。

渲染的速度使用*每秒的帧数*（fps）来表征，也就是每秒能渲染出多少张图片。也可以用*赫兹*（Hz）作为单位。使用渲染一张图片需要多少毫秒来表征速度的方法也很常见。
渲染一帧所需的时间根据实际情况会有很大差别。fps可以表征特定帧的生成速度，也可以表征平均的性能。赫兹用于硬件，是设置为定值的。

如其名，应用阶段是被应用驱动的，通常情况是在cpu上实现。cpu通常是多核的，具有并行处理的能力。因此适合处理应用阶段的各种各样的任务。常见的这样的任务有：碰撞检测，一些全局的加速优化（原文`global acceleration algorithms`），动画，物理模拟，等等。

下一个主要阶段是几何处理，负责坐标变换，投影，所有的几何上的处理。此阶段决定什么东西要被画，怎么画，画在哪。此阶段在gpu上执行，包含很多可编程的计算核和一些做死的计算硬件。

光栅化阶段把输入的3个顶点，组成三角形，然后找到内部的像素，然后把他们喂给下一个阶段。

最后像素阶段对每个像素执行一个程序，决定其颜色，或再根据深度测试决定是否像素可见。此阶段也可以执行其他逐像素操作，如根据前一个像素的颜色和新计算的像素的颜色混合出最终的颜色。
光栅化阶段和像素阶段都完全在gpu上执行。

接下来4个部分讨论所有这些阶段。更多细节见[图形处理单元](../chapter_3/chapter_3.md)

